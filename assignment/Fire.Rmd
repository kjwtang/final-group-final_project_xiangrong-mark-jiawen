---
title: "Current and Future Deforestation in Amazon Forest"
author: "Jiawen Tang, Mark Sun"
maketitle: true
output: github_document
---
```{r setup, messages = FALSE, cache = FALSE, warning = FALSE}
#install tmap to upgrade it each time when reopen the file
#install.packages('tmap')
suppressMessages({
  library(fs)
  library(terra)
  library(tidyverse)
  library(tmap)
})
```


```{r}
baulogg <-rast("bau_logg_final.tif") 
baufire <-rast("bau_fire_final.tif")
fire <- rast("fire.tif")
drought <- rast("drought.tif")
edge <- rast("edge.tif")
logging <- rast("logging.tif")
```

```{r}

#tm_shape(baulogg)+tm_raster()+tm_basemap()
data("World")
baulogg[baulogg < 0] <- NA
logmap <- tm_shape(World,bbox = stars::st_as_stars(baulogg))+tm_polygons() +
  tm_shape(baulogg)+tm_raster()
print(logmap)

```


```{r}
baufire[baufire < 0] <- NA
tm_shape(World,bbox = stars::st_as_stars(baufire))+tm_polygons() +
  tm_shape(baufire)+tm_raster()
```

```{r}
fire[fire == 0] <- NA
tm_shape(World,bbox = stars::st_as_stars(fire))+tm_polygons() +
  tm_shape(fire)+tm_raster(n=6)

```

```{r}
drought[drought == 0] <- NA
tm_shape(World,bbox = stars::st_as_stars(drought))+tm_polygons() +
  tm_shape(drought)+tm_raster(n=4)
```

```{r}
edge[edge == 0] <- NA
tm_shape(World,bbox = stars::st_as_stars(edge))+tm_polygons() +
  tm_shape(edge)+tm_raster(n=4)
```
```{r}
logging[logging == 0] <- NA
tm_shape(World,bbox = stars::st_as_stars(logging))+tm_polygons() +
  tm_shape(logging)+tm_raster(n=4)
```
```{r}
forest <- read.csv("def_area_2004_2019.csv")
colnames(forest)= c("Year","Acre","Amazonas","Amapa","Maranhao","Mato Grosso","Para","Rondonia","Roraima","Tocantins","Total")
forest
#read.csv("amazon.csv")
```

```{r}
#ggplot(forest,aes(x= Year,y=AC)) + geom_line()
library(reshape2)

deforest <- melt(forest,id="Year")
deforest_show <- ggplot(deforest,aes(x=Year,y=value,colour=variable,group=variable)) + geom_line()
deforest_show + labs(title = "Deforestation in different states of Amazon") + labs(x = "Year") + labs(y = "Deforested Area in"~km^2)
```

```{r}
a = c("Acre","Amazonas","Amapá","Maranhão","Mato Grosso","Pará","Rondônia","Roraima", "Tocantins")
b <- c(sum(forest$Acre),sum(forest$Amazonas),sum(forest$Amapa),sum(forest$Maranhao),sum(forest$`Mato Grosso`),sum(forest$Para),sum(forest$Rondonia),sum(forest$Roraima),sum(forest$Tocantins))
b
```

```{r}
code <- c("BR-AC","BR-AM","BR-AP","BR-MA","BR-MT","BR-PA","BR-RO","BR-RR","BR-TO") 
total_deforest <- data.frame(iso_3166_2 = code,
                   Area = b)
total_deforest

```

```{r}
install.packages("plotly")
library(plotly)
```


```{r}
# Create choropleth map

new_map <- plot_ly(
  total_deforest,
  type = "choropleth",
  locations = ~iso_3166_2,
  locationmode = "Bra",
  z = ~ Area,
  colorscale = "Viridis",
  colorbar = list(title = "Area")
) %>%
  layout(
    geo = list(
      center = list(lat = -14.235, lon = -51.925),  # Center of Brazil
      projection = list(type = 'mercator'),  # Specify the projection type
      scope = 'south america',  # Zoom in on South America
      showland = TRUE
    )
  )

# Display the map
new_map
```

```{r}
library(rnaturalearth)
library(sp)
library(sf)
```

```{r}
#sp::plot(ne_countries(country = "Brazil", scale = "large"))
states <- ne_states(country = "Brazil")
states <- st_as_sf(states)
states
states$iso_3166_2
final <- inner_join(states,total_deforest,by = "iso_3166_2" )
final$Area
```
```{r}
tm_shape(final) + tm_polygons("Area")
```







